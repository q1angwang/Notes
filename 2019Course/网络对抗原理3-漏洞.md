# 网络对抗原理3-漏洞


## 针对现状
稳定情绪和秩序
稳定

病毒

SDK对抗 SDK防御




## 从概念说起
维度 清晰认识 看的更专业
内行人至少需要清楚是哪个类型的漏洞，影响处置


程序设计错了
与
配置错了
——>
软件漏洞 vs 缺陷

软件漏洞：
- 自己写错了还是 别人出错了
- 通用软件(开发库)漏洞 vs 应用漏洞

应用安全 让开发写代码










## 应用漏洞说起：注入

更高的角度看：
    都是越界 数据的界限 越到了命令行

攻击角度：
    数据控制 数据可控 输入恶意构造请求构造数据













## 怎么学？

知识 方法论：(怎么学 怎么学漏洞)

安全对抗

怎么学？
1. 场景
    反复渲染 结合场景 
    学到漏洞，看上节课的图，看这个洞引申出来会造成什么？    为什么要学？学好了在哪些地方起作用；而不是单独的去学

2. 迈出第一步
    学习的路径

    ssh 扫端口 一顿操作猛如虎

    每次畸形的sql注入，需要持久化——进去后添加员工，正常登陆
    
    回顾攻击路径 得到权限 登陆信息凭据的获取

3. 细节
    每个人都会了 万能密码

    学细节 各个维度上

    注入的模板 从最典型最普通的开始

    数据域(用户可控)/控制域(控制数据库)

    u: admin
    p:  a' OR 'a'='a
    提到细节 掌握sql注入 我们可以做什么





## 两个实验
实验1 点亮 webgoat
实验2 sql深入学习 写很多这种示例 稍微改一改 输出姓名 输出存不存在 输出随机数 输出timesleep 构建不同的应用场景。

    怎么展示 
    抓包 观测窗口/实验 网络上是怎么传的
    mysql后台的日志 后台执行了什么 新的观测 后台怎么执行的

    观测 实验
    最后 一个工具 sqlmap 调不同的参数
    两个极端 对工具的态度(下节课)
    工具是发什么包 分析工具的参数 时序上看到工具干了什么 了解背后原理 数据库日志抓了很多的请求 干什么用的
    执行了一句话就。。。
    观测到 这样的输入 输出 一个数据包就能得到我想要的数据 把观测来的语句在数据库执行一下
    把执行语句一层一层拆解
    union 去查 前缀 后缀 与观测对应上
    至少知道56个观测点 多维度的

    不查数据 查当前用户
    实现不同功能是怎么做的 知道背后原理


    sql注入

    看到的是现象 -T
    数据库层 网络层 通过观测

    这个语句是3种技术都可以


攻击 不是学参数
驱动大神输参数的，是他知道后台执行了什么 我要做什么事情 工具做成事情
参数能干什么不是最重要的 学偏了
反过来利用工具 掌握了这个漏洞

















## SQL注入 攻击向量

1. 闭合部分
2. 注入向量 攻击向量 //想取到的数据
3. 注释部分

常见注释：

    # 在url里表现为结束 编码成23%才行 在浏览器层面就截断了
    保险的-- #




## SQL注入技术

数据溢出到控制域
找不找得到注入点 看能不能做闭合
干什么事儿 由注入向量
是否真正执行 取决于注释部分

驱动sqlmap 干你想干的事儿

原理 怎么实现的 哪些场合应用
union query 会把查询的内容输出出来的地方
    展示用户分的地方展现表名 前后缀 一下子得到结果
    没有输出怎么办

boolen base
    登陆成功/不成功
    1=1 1=2 成功 就观测到登陆成功
    每次有一次观测
    2分法 第一个字符的ascii 查数据库中内容
    不停的发><的工程
    看懂工具的攻击过程
time base
    场景在现实些
    不管输入成功/失败 同一个结果
    人工制造 
    1=1 AND SLEEP(5)
    1=2 AND SLEEP(5)
    1=1那个地方的逻辑是否正确可以体现在返回时间 利用返回时间得到1bit的信息

在数据库日志中都可以查到
攻击向量
综合应用学会知识


3中方法的速度快慢减少
应用范围增大




sqlmap 慢 
    知道对目标干什么 用户了解清楚 渗透才好做下去
陷入没有好工具这个思维 就没学到了 low了






掌握的
配日志 抓包软件
配置java
浏览器代理
mysql配置

看上去很乱
自己思维理顺
学会观测 学会设计实验 学会总结 才算最后学会了







后面例子的学习 都遵从这个同样的标准学习

















## NoSQL注入

- 非关系型数据库 存在注入问题
nosql
php 与mangdb没关系 php传递给出去的json 
一个万能密码 ![]()

变成了比较运算 逻辑运算符

结合了php的错误 mangdb的特性 两个一起构成了一个漏洞
存在输入/语句控制的地方






- 命令行注入

功能设计为ping几次

无url 安全 避免脚本小子 提高安全成本！

echo ;

数据域出去了



溢出 传的参数不是按照约定的长度，是恶意构造的
cpu把当成语句执行
ms160
08067都是溢出






## 溢出

os 保护返回地址 动态返回地址

想办法绕过
原理都是找到溢出点




## Struts2 OGNL

从string到命令

根本 用户的输入数据 自动转成语句
后来不断的修正 想办法去控制 但用户不断修改输入数据 想办法去绕过控制
struts2的根本

默认这个机器被控制了，因为机制原理上存在的问题：
    php写的开源后台 论坛 各种开源cms
    php的语言没问题 问题出在用语言上 偏实现功能 不关注安全问题














# XSS
最终溢出了，在用户浏览器中执行了语句

封闭属性 标签里面封闭标签
变量里 js放入 直接执行不用封闭



搭建一个xss的漏洞平台

var a=$a

xss盗号
xss蠕虫

xss反射型 应用场景是什么 谁提交了影响什么 产生危害
    攻击行为和受害行为分离了

不然前端的js能读到用户id session cookie
服务端 设置httponly 浏览器不会让js读到

不设httponly才会被攻击

客户端限制


## url任意跳转 做钓鱼






//学会原理 看书 知道标准








## CSRF

SSRF让你不构成请求 不知道cookie
其他方法 
检测？防止？但还是会被绕过

 加csrf的token解决
怎么起作用的


http里只是参数 价格0.1 校验 水平权限的校验不够
乌云的漏洞库中有很多这类的








# 重点：

!漏洞的概念 配置 //最开始的ppt

观测点

sql结构 封闭 闭合 注入向量

注入技术 区别 原理  横向 学 不同的注入漏洞 数据与控制欲的越界

xss的原理 xss 的存储新的重要性

csrf的原理 修复了解

水平权限的实例 多看几个

url跳转的应用场景 弱密码的应用场景